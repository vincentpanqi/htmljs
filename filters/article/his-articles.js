// Generated by CoffeeScript 1.9.3
(function() {
  var func_article, func_column;

  func_column = __F('column');

  func_article = __F('article/article');

  module.exports = function(req, res, next) {
    var condition, count, page;
    console.log('dd');
    condition = {
      is_yuanchuang: 1,
      user_id: res.locals.who.id
    };
    page = req.query.page || 1;
    count = req.query.count || 20;
    return func_article.count(condition, function(error, _count) {
      if (error) {
        return next(error);
      } else if (_count === 0) {
        return next(new Error('这位大大还没有写过任何原创文章'));
      } else {
        res.locals.total = _count;
        res.locals.totalPage = Math.ceil(_count / count);
        res.locals.page = req.query.page || 1;
        return func_article.getAll(page, count, condition, function(error, articles) {
          if (error) {
            return next(error);
          } else {
            res.locals.articles = articles;
            return next();
          }
        });
      }
    });
  };

}).call(this);
