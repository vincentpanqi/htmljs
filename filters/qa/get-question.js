// Generated by CoffeeScript 1.9.3
(function() {
  var func_comment, func_question;

  func_question = __F('question');

  func_comment = __F('comment');

  module.exports = function(req, res, next) {
    if (/^[0-9]*$/.test(req.params.id)) {
      return func_question.getById(req.params.id, function(error, question) {
        if (error) {
          return next(error);
        } else if (!question) {
          return next(new Error('不存在的问题'));
        } else {
          res.locals.question = question;
          return func_comment.getAllByTargetId('question_' + question.id, 1, 10, null, "id", function(error, comments) {
            res.locals.question_comments = comments;
            return next();
          });
        }
      });
    } else {
      return func_question.getByPinyin(req.params.id, function(error, question) {
        if (error) {
          return next(error);
        } else if (!question) {
          return next(new Error('不存在的问题'));
        } else {
          req.params.id = question.id;
          res.locals.question = question;
          return func_comment.getAllByTargetId('question_' + question.id, 1, 10, null, "id", function(error, comments) {
            res.locals.question_comments = comments;
            return next();
          });
        }
      });
    }
  };

}).call(this);
